<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS接码平台 API 测试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2196F3;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--primary-color);
        }

        .test-all-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .test-all-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .api-section {
            background: var(--card-bg);
            padding: 24px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .api-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .api-title {
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .api-title .test-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-weight: 500;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background-color: #1976D2;
            transform: translateY(-2px);
        }

        .response {
            margin-top: 20px;
            padding: 16px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            color: #666;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .tab:hover {
            background: rgba(33, 150, 243, 0.1);
            color: var(--primary-color);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .token-display {
            background: #e3f2fd;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 8px;
            word-break: break-all;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .token-display i {
            color: var(--primary-color);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-success {
            background: #e8f5e9;
            color: var(--success-color);
        }

        .status-error {
            background: #ffebee;
            color: var(--error-color);
        }

        .status-warning {
            background: #fff3e0;
            color: var(--warning-color);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .test-result {
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-result.success {
            background: #e8f5e9;
        }

        .test-result.error {
            background: #ffebee;
        }

        .test-summary {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .test-summary-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .summary-item i {
            color: var(--primary-color);
        }

        .test-duration {
            margin-left: auto;
            color: #666;
            font-size: 0.9em;
        }

        .test-history {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 4px;
            margin: 4px 0;
        }

        .history-item.success {
            background: #e8f5e9;
        }

        .history-item.error {
            background: #ffebee;
        }

        .history-time {
            color: #666;
            font-size: 0.9em;
        }

        .history-status {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .history-duration {
            margin-left: auto;
            color: #666;
            font-size: 0.9em;
        }

        .log-container {
            margin-top: 20px;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
        }

        .log-item {
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
            color: #fff;
        }

        .log-item.info {
            background: #2196F3;
        }

        .log-item.success {
            background: #4CAF50;
        }

        .log-item.error {
            background: #f44336;
        }

        .log-item.warning {
            background: #ff9800;
        }

        .log-time {
            color: #aaa;
            margin-right: 8px;
        }

        .log-type {
            font-weight: bold;
            margin-right: 8px;
        }

        .auto-test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auto-test-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .auto-test-btn.stop {
            background: var(--error-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SMS接码平台 API 测试页面</h1>
            <button class="test-all-btn" onclick="testAll()">
                <i class="mdi mdi-play"></i>
                一键测试所有API
            </button>
            <div class="auto-test-controls">
                <button class="auto-test-btn" onclick="startAutoTest()">
                    <i class="mdi mdi-play"></i>
                    开始自动测试
                </button>
                <button class="auto-test-btn stop" onclick="stopAutoTest()">
                    <i class="mdi mdi-stop"></i>
                    停止自动测试
                </button>
            </div>
        </div>
        
        <div class="token-display">
            <i class="mdi mdi-key"></i>
            <strong>当前Token:</strong> <span id="currentToken">未登录</span>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('auth')">
                <i class="mdi mdi-shield-account"></i>
                认证相关
            </div>
            <div class="tab" onclick="showTab('user')">
                <i class="mdi mdi-account"></i>
                用户相关
            </div>
            <div class="tab" onclick="showTab('project')">
                <i class="mdi mdi-folder"></i>
                项目相关
            </div>
            <div class="tab" onclick="showTab('phone')">
                <i class="mdi mdi-phone"></i>
                手机号相关
            </div>
            <div class="tab" onclick="showTab('sms')">
                <i class="mdi mdi-message"></i>
                短信相关
            </div>
            <div class="tab" onclick="showTab('system')">
                <i class="mdi mdi-cog"></i>
                系统相关
            </div>
            <div class="tab" onclick="showTab('admin')">
                <i class="mdi mdi-shield-star"></i>
                管理员相关
            </div>
        </div>

        <!-- 认证相关 -->
        <div id="auth" class="tab-content active">
            <div class="api-section">
                <h2 class="api-title">
                    用户登录
                    <button class="test-btn" onclick="login()">
                        <i class="mdi mdi-play"></i>
                        测试
                    </button>
                </h2>
                <div class="form-group">
                    <label>用户名:</label>
                    <input type="text" id="loginUsername">
                </div>
                <div class="form-group">
                    <label>密码:</label>
                    <input type="password" id="loginPassword">
                </div>
                <div class="response" id="loginResponse"></div>
            </div>

            <div class="api-section">
                <h2 class="api-title">
                    用户注册
                    <button class="test-btn" onclick="register()">
                        <i class="mdi mdi-play"></i>
                        测试
                    </button>
                </h2>
                <div class="form-group">
                    <label>用户名:</label>
                    <input type="text" id="registerUsername">
                </div>
                <div class="form-group">
                    <label>邮箱:</label>
                    <input type="text" id="registerEmail">
                </div>
                <div class="form-group">
                    <label>密码:</label>
                    <input type="password" id="registerPassword">
                </div>
                <div class="response" id="registerResponse"></div>
            </div>
        </div>

        <!-- 用户相关 -->
        <div id="user" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">获取用户信息</h2>
                <button onclick="getUserProfile()">获取信息</button>
                <div class="response" id="userProfileResponse"></div>
            </div>

            <div class="api-section">
                <h2 class="api-title">更新用户信息</h2>
                <div class="form-group">
                    <label>新邮箱:</label>
                    <input type="text" id="updateEmail">
                </div>
                <div class="form-group">
                    <label>新密码:</label>
                    <input type="password" id="updatePassword">
                </div>
                <button onclick="updateUserProfile()">更新信息</button>
                <div class="response" id="updateProfileResponse"></div>
            </div>
        </div>

        <!-- 项目相关 -->
        <div id="project" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">获取项目列表</h2>
                <div class="form-group">
                    <label>页码:</label>
                    <input type="number" id="projectPage" value="1">
                </div>
                <div class="form-group">
                    <label>每页数量:</label>
                    <input type="number" id="projectPerPage" value="10">
                </div>
                <button onclick="getProjects()">获取列表</button>
                <div class="response" id="projectsResponse"></div>
            </div>
        </div>

        <!-- 手机号相关 -->
        <div id="phone" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">获取手机号</h2>
                <div class="form-group">
                    <label>项目ID:</label>
                    <input type="text" id="getPhoneProjectId">
                </div>
                <button onclick="getPhone()">获取手机号</button>
                <div class="response" id="getPhoneResponse"></div>
            </div>

            <div class="api-section">
                <h2 class="api-title">获取手机号列表</h2>
                <div class="form-group">
                    <label>项目ID:</label>
                    <input type="text" id="listPhoneProjectId">
                </div>
                <div class="form-group">
                    <label>状态:</label>
                    <input type="text" id="listPhoneStatus">
                </div>
                <div class="form-group">
                    <label>页码:</label>
                    <input type="number" id="listPhonePage" value="1">
                </div>
                <div class="form-group">
                    <label>每页数量:</label>
                    <input type="number" id="listPhonePerPage" value="20">
                </div>
                <button onclick="listPhones()">获取列表</button>
                <div class="response" id="listPhonesResponse"></div>
            </div>
        </div>

        <!-- 短信相关 -->
        <div id="sms" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">获取短信列表</h2>
                <div class="form-group">
                    <label>手机号ID:</label>
                    <input type="text" id="smsPhoneId">
                </div>
                <div class="form-group">
                    <label>页码:</label>
                    <input type="number" id="smsPage" value="1">
                </div>
                <div class="form-group">
                    <label>每页数量:</label>
                    <input type="number" id="smsPerPage" value="20">
                </div>
                <button onclick="getSmsList()">获取短信</button>
                <div class="response" id="smsListResponse"></div>
            </div>
        </div>

        <!-- 系统相关 -->
        <div id="system" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">系统健康检查</h2>
                <button onclick="checkHealth()">检查健康状态</button>
                <div class="response" id="healthResponse"></div>
            </div>

            <div class="api-section">
                <h2 class="api-title">系统指标</h2>
                <button onclick="getMetrics()">获取指标</button>
                <div class="response" id="metricsResponse"></div>
            </div>

            <div class="api-section">
                <h2 class="api-title">支持的语言</h2>
                <button onclick="getLanguages()">获取语言列表</button>
                <div class="response" id="languagesResponse"></div>
            </div>
        </div>

        <!-- 管理员相关 -->
        <div id="admin" class="tab-content">
            <div class="api-section">
                <h2 class="api-title">获取用户列表</h2>
                <div class="form-group">
                    <label>页码:</label>
                    <input type="number" id="adminUsersPage" value="1">
                </div>
                <div class="form-group">
                    <label>每页数量:</label>
                    <input type="number" id="adminUsersPerPage" value="10">
                </div>
                <div class="form-group">
                    <label>过滤关键词:</label>
                    <input type="text" id="adminUsersFilter">
                </div>
                <button onclick="getAdminUsers()">获取用户列表</button>
                <div class="response" id="adminUsersResponse"></div>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:5000/api';
        let currentToken = '';

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        function updateToken(token) {
            currentToken = token;
            document.getElementById('currentToken').textContent = token || '未登录';
        }

        async function makeRequest(url, method = 'GET', data = null) {
            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json; charset=utf-8'
            };
            if (currentToken) {
                headers['Authorization'] = `Bearer ${currentToken}`;
            }

            try {
                const response = await fetch(`${BASE_URL}${url}`, {
                    method,
                    headers,
                    body: data ? JSON.stringify(data) : null
                });
                
                // 处理响应编码
                const contentType = response.headers.get('content-type');
                let result;
                if (contentType && contentType.includes('application/json')) {
                    result = await response.json();
                } else {
                    const text = await response.text();
                    try {
                        result = JSON.parse(text);
                    } catch (e) {
                        result = { error: text };
                    }
                }

                // 添加状态标记
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge ${response.ok ? 'status-success' : 'status-error'}`;
                statusBadge.textContent = response.ok ? '成功' : '失败';
                
                const responseElement = document.querySelector(`#${url.split('/').pop()}Response`);
                if (responseElement) {
                    responseElement.prepend(statusBadge);
                    responseElement.textContent = JSON.stringify(result, null, 2);
                }
                
                return result;
            } catch (error) {
                const statusBadge = document.createElement('span');
                statusBadge.className = 'status-badge status-error';
                statusBadge.textContent = '错误';
                
                const responseElement = document.querySelector(`#${url.split('/').pop()}Response`);
                if (responseElement) {
                    responseElement.prepend(statusBadge);
                    responseElement.textContent = JSON.stringify({ error: error.message }, null, 2);
                }
                
                return { error: error.message };
            }
        }

        async function login() {
            const button = document.querySelector('#auth .test-btn');
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div>';
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const result = await makeRequest('/auth/login', 'POST', { username, password });
            if (result.token) {
                updateToken(result.token);
            }
            document.getElementById('loginResponse').textContent = JSON.stringify(result, null, 2);
            
            button.innerHTML = originalText;
        }

        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const result = await makeRequest('/auth/register', 'POST', { username, email, password });
            if (result.token) {
                updateToken(result.token);
            }
            document.getElementById('registerResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getUserProfile() {
            const result = await makeRequest('/auth/profile');
            document.getElementById('userProfileResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function updateUserProfile() {
            const email = document.getElementById('updateEmail').value;
            const password = document.getElementById('updatePassword').value;
            const data = {};
            if (email) data.email = email;
            if (password) data.password = password;
            const result = await makeRequest('/auth/profile', 'PUT', data);
            document.getElementById('updateProfileResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getProjects() {
            const page = document.getElementById('projectPage').value;
            const perPage = document.getElementById('projectPerPage').value;
            const result = await makeRequest(`/projects?page=${page}&per_page=${perPage}`);
            document.getElementById('projectsResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getPhone() {
            const projectId = document.getElementById('getPhoneProjectId').value;
            const result = await makeRequest(`/numbers/get?project_id=${projectId}`);
            document.getElementById('getPhoneResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function listPhones() {
            const projectId = document.getElementById('listPhoneProjectId').value;
            const status = document.getElementById('listPhoneStatus').value;
            const page = document.getElementById('listPhonePage').value;
            const perPage = document.getElementById('listPhonePerPage').value;
            let url = `/numbers/history?page=${page}&per_page=${perPage}`;
            if (projectId) url += `&project_id=${projectId}`;
            if (status) url += `&status=${status}`;
            const result = await makeRequest(url);
            document.getElementById('listPhonesResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getSmsList() {
            const phoneId = document.getElementById('smsPhoneId').value;
            const page = document.getElementById('smsPage').value;
            const perPage = document.getElementById('smsPerPage').value;
            const result = await makeRequest(`/numbers/${phoneId}/messages?page=${page}&per_page=${perPage}`);
            document.getElementById('smsListResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function checkHealth() {
            const result = await makeRequest('/system/health');
            document.getElementById('healthResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getMetrics() {
            const result = await makeRequest('/system/metrics');
            document.getElementById('metricsResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getLanguages() {
            const result = await makeRequest('/system/languages');
            document.getElementById('languagesResponse').textContent = JSON.stringify(result, null, 2);
        }

        async function getAdminUsers() {
            const page = document.getElementById('adminUsersPage').value;
            const perPage = document.getElementById('adminUsersPerPage').value;
            const filter = document.getElementById('adminUsersFilter').value;
            let url = `/admin/users?page=${page}&per_page=${perPage}`;
            if (filter) url += `&filter=${filter}`;
            const result = await makeRequest(url);
            document.getElementById('adminUsersResponse').textContent = JSON.stringify(result, null, 2);
        }

        // 智能测试功能
        class SmartTester {
            constructor() {
                this.testHistory = [];
                this.currentUser = null;
                this.testData = {
                    username: 'testuser_' + Date.now(),
                    email: `test${Date.now()}@example.com`,
                    password: 'test123456',
                    projectId: '1'
                };
                this.logContainer = null;
                this.autoTestInterval = null;
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleString();
                const logMessage = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
                console.log(logMessage);
                
                if (this.logContainer) {
                    const logElement = document.createElement('div');
                    logElement.className = `log-item ${type}`;
                    logElement.innerHTML = `
                        <span class="log-time">${timestamp}</span>
                        <span class="log-type">${type.toUpperCase()}</span>
                        <span class="log-message">${message}</span>
                    `;
                    this.logContainer.appendChild(logElement);
                    this.logContainer.scrollTop = this.logContainer.scrollHeight;
                }
            }

            async runTest(testCase) {
                const startTime = Date.now();
                this.log(`开始测试: ${testCase.name}`);
                
                try {
                    await testCase.func();
                    const duration = Date.now() - startTime;
                    this.log(`测试通过: ${testCase.name} (耗时: ${duration}ms)`, 'success');
                    
                    this.testHistory.push({
                        name: testCase.name,
                        status: 'success',
                        duration,
                        timestamp: new Date().toISOString()
                    });
                    return { success: true, duration };
                } catch (error) {
                    const duration = Date.now() - startTime;
                    this.log(`测试失败: ${testCase.name} - ${error.message}`, 'error');
                    
                    this.testHistory.push({
                        name: testCase.name,
                        status: 'error',
                        error: error.message,
                        duration,
                        timestamp: new Date().toISOString()
                    });
                    return { success: false, error: error.message, duration };
                }
            }

            async runAllTests() {
                this.log('开始执行所有测试用例');
                
                const testCases = [
                    // 系统相关
                    { name: '系统健康检查', func: checkHealth },
                    { name: '获取支持的语言', func: getLanguages },
                    { name: '获取系统指标', func: getMetrics },
                    
                    // 认证相关
                    { name: '用户注册', func: async () => {
                        this.log('准备注册新用户');
                        document.getElementById('registerUsername').value = this.testData.username;
                        document.getElementById('registerEmail').value = this.testData.email;
                        document.getElementById('registerPassword').value = this.testData.password;
                        const result = await register();
                        if (result.token) {
                            this.currentUser = {
                                username: this.testData.username,
                                token: result.token
                            };
                            this.log(`用户注册成功: ${this.testData.username}`);
                        }
                    }},
                    { name: '用户登录', func: async () => {
                        this.log('准备登录用户');
                        document.getElementById('loginUsername').value = this.testData.username;
                        document.getElementById('loginPassword').value = this.testData.password;
                        const result = await login();
                        if (result.token) {
                            this.currentUser = {
                                username: this.testData.username,
                                token: result.token
                            };
                            this.log(`用户登录成功: ${this.testData.username}`);
                        }
                    }},
                    
                    // 用户相关
                    { name: '获取用户信息', func: async () => {
                        this.log('获取用户信息');
                        await getUserProfile();
                    }},
                    { name: '更新用户信息', func: async () => {
                        this.log('更新用户信息');
                        document.getElementById('updateEmail').value = `updated${Date.now()}@example.com`;
                        await updateUserProfile();
                    }},
                    
                    // 项目相关
                    { name: '获取项目列表', func: async () => {
                        this.log('获取项目列表');
                        await getProjects();
                    }},
                    
                    // 手机号相关
                    { name: '获取手机号', func: async () => {
                        this.log('获取手机号');
                        document.getElementById('getPhoneProjectId').value = this.testData.projectId;
                        await getPhone();
                    }},
                    { name: '获取手机号列表', func: async () => {
                        this.log('获取手机号列表');
                        document.getElementById('listPhoneProjectId').value = this.testData.projectId;
                        document.getElementById('listPhoneStatus').value = 'active';
                        await listPhones();
                    }},
                    
                    // 短信相关
                    { name: '获取短信列表', func: async () => {
                        this.log('获取短信列表');
                        document.getElementById('smsPhoneId').value = '1';
                        await getSmsList();
                    }},
                    
                    // 管理员相关
                    { name: '获取用户列表(管理员)', func: async () => {
                        this.log('获取管理员用户列表');
                        document.getElementById('adminUsersPage').value = '1';
                        document.getElementById('adminUsersPerPage').value = '10';
                        await getAdminUsers();
                    }}
                ];

                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                const progressFill = document.createElement('div');
                progressFill.className = 'progress-bar-fill';
                progressBar.appendChild(progressFill);
                document.querySelector('.container').appendChild(progressBar);

                const resultsContainer = document.createElement('div');
                resultsContainer.className = 'api-section';
                resultsContainer.innerHTML = `
                    <h2 class="api-title">智能测试结果</h2>
                    <div class="test-summary"></div>
                    <div class="response" id="testResults"></div>
                    <div class="log-container"></div>
                `;
                document.querySelector('.container').appendChild(resultsContainer);
                
                this.logContainer = resultsContainer.querySelector('.log-container');

                const startTime = Date.now();
                const results = [];
                let successCount = 0;
                let totalDuration = 0;

                for (let i = 0; i < testCases.length; i++) {
                    const testCase = testCases[i];
                    const result = await this.runTest(testCase);
                    results.push(result);
                    if (result.success) successCount++;
                    totalDuration += result.duration;
                    progressFill.style.width = `${((i + 1) / testCases.length) * 100}%`;
                }

                const endTime = Date.now();
                const totalTime = endTime - startTime;
                this.log(`所有测试完成，总耗时: ${totalTime}ms`);

                // 显示测试摘要
                const summaryHtml = `
                    <div class="test-summary-content">
                        <div class="summary-item">
                            <i class="mdi mdi-check-circle"></i>
                            <span>成功: ${successCount}/${testCases.length}</span>
                        </div>
                        <div class="summary-item">
                            <i class="mdi mdi-clock-outline"></i>
                            <span>总耗时: ${totalTime}ms</span>
                        </div>
                        <div class="summary-item">
                            <i class="mdi mdi-account"></i>
                            <span>测试用户: ${this.currentUser ? this.currentUser.username : '未登录'}</span>
                        </div>
                    </div>
                `;
                document.querySelector('.test-summary').innerHTML = summaryHtml;

                // 显示详细测试结果
                const resultsHtml = results.map((result, index) => `
                    <div class="test-result ${result.success ? 'success' : 'error'}">
                        <span class="status-badge status-${result.success ? 'success' : 'error'}">
                            ${result.success ? '成功' : '失败'}
                        </span>
                        <strong>${testCases[index].name}:</strong>
                        <span>${result.success ? '测试通过' : result.error}</span>
                        <span class="test-duration">${result.duration}ms</span>
                    </div>
                `).join('');
                document.getElementById('testResults').innerHTML = resultsHtml;

                // 添加测试历史记录
                const historyHtml = `
                    <div class="test-history">
                        <h3>测试历史</h3>
                        <div class="history-list">
                            ${this.testHistory.map(record => `
                                <div class="history-item ${record.status}">
                                    <span class="history-time">${new Date(record.timestamp).toLocaleString()}</span>
                                    <span class="history-name">${record.name}</span>
                                    <span class="history-status">${record.status}</span>
                                    <span class="history-duration">${record.duration}ms</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                resultsContainer.insertAdjacentHTML('beforeend', historyHtml);

                setTimeout(() => {
                    progressBar.remove();
                }, 2000);
            }

            startAutoTest(interval = 300000) { // 默认5分钟
                this.log(`开始自动测试，间隔: ${interval/1000}秒`);
                this.autoTestInterval = setInterval(() => {
                    this.runAllTests();
                }, interval);
            }

            stopAutoTest() {
                if (this.autoTestInterval) {
                    clearInterval(this.autoTestInterval);
                    this.autoTestInterval = null;
                    this.log('停止自动测试');
                }
            }
        }

        // 更新一键测试功能
        async function testAll() {
            const tester = new SmartTester();
            await tester.runAllTests();
        }

        // 添加自动测试控制
        function startAutoTest() {
            const interval = parseInt(prompt('请输入自动测试间隔（秒）:', '300')) * 1000;
            if (interval > 0) {
                const tester = new SmartTester();
                tester.startAutoTest(interval);
            }
        }

        function stopAutoTest() {
            if (window.currentTester) {
                window.currentTester.stopAutoTest();
            }
        }
    </script>
</body>
</html> 