<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>接码平台API测试界面</title>
    <!-- 引入Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入Font Awesome图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            padding-bottom: 50px;
        }
        
        .navbar {
            background-color: var(--dark-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: bold;
            color: white !important;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-top-left-radius: 10px !important;
            border-top-right-radius: 10px !important;
            padding: 15px 20px;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
        }
        
        .nav-pills .nav-link {
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .tab-pane {
            padding: 20px 0;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #ddd;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .badge {
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .result-panel {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result-panel pre {
            margin-bottom: 0;
            white-space: pre-wrap;
        }
        
        .api-description {
            margin-bottom: 15px;
            color: #666;
        }
        
        .required-field::after {
            content: ' *';
            color: var(--danger-color);
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
        
        .user-info {
            background: var(--light-color);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .api-item {
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        
        .api-item:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        #loading {
            display: none;
        }
        
        .spinner-border {
            width: 1rem;
            height: 1rem;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-sms me-2"></i>接码平台API测试界面
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="clearToken">
                            <i class="fas fa-sign-out-alt me-1"></i>清除凭证
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- 用户信息区域 -->
        <div class="user-info d-none" id="userInfoPanel">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>用户名：</strong><span id="usernameInfo">-</span></p>
                    <p class="mb-1"><strong>邮箱：</strong><span id="emailInfo">-</span></p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-1"><strong>账户余额：</strong><span id="balanceInfo">-</span> 元</p>
                    <p class="mb-1"><strong>状态：</strong><span class="badge bg-success" id="statusInfo">已登录</span></p>
                </div>
            </div>
        </div>

        <!-- 未登录时的登录/注册选项卡 -->
        <div class="card" id="authCard">
            <div class="card-header">
                <i class="fas fa-user-lock me-2"></i>用户认证
            </div>
            <div class="card-body">
                <ul class="nav nav-pills mb-3" id="authTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="login-tab" data-bs-toggle="pill" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">登录</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="register-tab" data-bs-toggle="pill" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">注册</button>
                    </li>
                </ul>
                <div class="tab-content" id="authTabContent">
                    <!-- 登录表单 -->
                    <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="username" class="form-label required-field">用户名</label>
                                <input type="text" class="form-control" id="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label required-field">密码</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt me-1"></i>登录
                            </button>
                        </form>
                    </div>
                    
                    <!-- 注册表单 -->
                    <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                        <form id="registerForm">
                            <div class="mb-3">
                                <label for="regUsername" class="form-label required-field">用户名</label>
                                <input type="text" class="form-control" id="regUsername" required>
                            </div>
                            <div class="mb-3">
                                <label for="regEmail" class="form-label required-field">邮箱</label>
                                <input type="email" class="form-control" id="regEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="regPassword" class="form-label required-field">密码</label>
                                <input type="password" class="form-control" id="regPassword" required>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-user-plus me-1"></i>注册
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- API 测试面板 -->
        <div class="row d-none" id="apiTestPanel">
            <!-- API 分类 -->
            <div class="col-md-3">
                <div class="card sticky-top" style="top: 20px">
                    <div class="card-header">
                        <i class="fas fa-list me-2"></i>API分类
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <a href="#user-apis" class="list-group-item list-group-item-action">用户管理</a>
                            <a href="#project-apis" class="list-group-item list-group-item-action">项目管理</a>
                            <a href="#number-apis" class="list-group-item list-group-item-action">号码管理</a>
                            <a href="#account-apis" class="list-group-item list-group-item-action">账户管理</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API 测试内容 -->
            <div class="col-md-9">
                <!-- 用户管理API -->
                <div class="card" id="user-apis">
                    <!-- 此处将在JavaScript中动态加载API测试表单 -->
                </div>
                
                <!-- 项目管理API -->
                <div class="card" id="project-apis">
                    <!-- 此处将在JavaScript中动态加载API测试表单 -->
                </div>
                
                <!-- 号码管理API -->
                <div class="card" id="number-apis">
                    <!-- 此处将在JavaScript中动态加载API测试表单 -->
                </div>
                
                <!-- 账户管理API -->
                <div class="card" id="account-apis">
                    <!-- 此处将在JavaScript中动态加载API测试表单 -->
                </div>
            </div>
        </div>
        
        <!-- 结果显示模态框 -->
        <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resultModalLabel">API 响应结果</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="result-panel">
                            <pre id="resultContent">等待API响应...</pre>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="copyResult">
                            <i class="fas fa-copy me-1"></i>复制
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loading" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center" style="background-color: rgba(0,0,0,0.5); z-index: 9999;">
        <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">加载中...</span>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        // 全局变量
        let userToken = localStorage.getItem('sms_platform_token');
        let userData = JSON.parse(localStorage.getItem('sms_platform_user') || '{}');
        let baseUrl = ''; // 默认为空，相对路径
        
        // 定义API列表
        const apiList = {
            user: [
                {
                    name: "获取个人资料",
                    endpoint: "/api/auth/profile",
                    method: "GET",
                    description: "获取当前登录用户的个人资料信息",
                    params: []
                },
                {
                    name: "修改密码",
                    endpoint: "/api/auth/change-password",
                    method: "GET",
                    description: "修改当前登录用户的密码",
                    params: [
                        { name: "old_password", label: "旧密码", type: "password", required: true },
                        { name: "new_password", label: "新密码", type: "password", required: true }
                    ]
                }
            ],
            project: [
                {
                    name: "获取项目列表",
                    endpoint: "/api/projects",
                    method: "GET",
                    description: "获取所有可用项目列表",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 },
                        { name: "keyword", label: "搜索关键词", type: "text" }
                    ]
                },
                {
                    name: "搜索项目",
                    endpoint: "/api/projects/search",
                    method: "GET",
                    description: "根据关键词搜索项目",
                    params: [
                        { name: "keyword", label: "搜索关键词", type: "text", required: true }
                    ]
                },
                {
                    name: "收藏项目",
                    endpoint: "/api/projects/favorite/{project_id}",
                    method: "GET",
                    description: "将指定项目添加到收藏列表",
                    params: [
                        { name: "project_id", label: "项目ID", type: "number", required: true, isPathParam: true }
                    ]
                },
                {
                    name: "取消收藏项目",
                    endpoint: "/api/projects/favorite/{project_id}",
                    method: "GET",
                    description: "从收藏列表中删除指定项目",
                    params: [
                        { name: "project_id", label: "项目ID", type: "number", required: true, isPathParam: true },
                        { name: "action", label: "操作", type: "hidden", value: "delete", required: true }
                    ]
                },
                {
                    name: "获取收藏的项目列表",
                    endpoint: "/api/projects/favorites",
                    method: "GET",
                    description: "获取用户已收藏的所有项目",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 }
                    ]
                },
                {
                    name: "获取专属对接的项目列表",
                    endpoint: "/api/projects/exclusive",
                    method: "GET",
                    description: "获取用户已加入专属对接的项目列表",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 }
                    ]
                },
                {
                    name: "加入专属对接",
                    endpoint: "/api/projects/exclusive/{project_id}",
                    method: "GET",
                    description: "加入指定项目的专属对接",
                    params: [
                        { name: "project_id", label: "项目ID", type: "number", required: true, isPathParam: true }
                    ]
                },
                {
                    name: "获取所有可加入的专属项目",
                    endpoint: "/api/projects/all-exclusive",
                    method: "GET",
                    description: "获取所有可加入专属对接的项目列表",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 }
                    ]
                }
            ],
            number: [
                {
                    name: "取号（获取手机号）",
                    endpoint: "/api/numbers/get",
                    method: "GET",
                    description: "随机获取一个可用的手机号码",
                    params: [
                        { name: "project_code", label: "项目代码", type: "text", required: true }
                    ]
                },
                {
                    name: "指定取号（获取指定手机号）",
                    endpoint: "/api/numbers/get-specific",
                    method: "GET",
                    description: "获取指定的手机号码",
                    params: [
                        { name: "project_code", label: "项目代码", type: "text", required: true },
                        { name: "number", label: "手机号码", type: "text", required: true }
                    ]
                },
                {
                    name: "获取短信验证码",
                    endpoint: "/api/numbers/sms/{request_id}",
                    method: "GET",
                    description: "获取指定请求ID对应的短信验证码",
                    params: [
                        { name: "request_id", label: "请求ID", type: "text", required: true, isPathParam: true }
                    ]
                },
                {
                    name: "释放号码",
                    endpoint: "/api/numbers/release/{request_id}",
                    method: "GET",
                    description: "释放指定请求ID对应的手机号码",
                    params: [
                        { name: "request_id", label: "请求ID", type: "text", required: true, isPathParam: true }
                    ]
                },
                {
                    name: "拉黑号码",
                    endpoint: "/api/numbers/blacklist",
                    method: "GET",
                    description: "将指定手机号码加入黑名单",
                    params: [
                        { name: "number", label: "手机号码", type: "text", required: true },
                        { name: "reason", label: "拉黑原因", type: "text" }
                    ]
                },
                {
                    name: "获取我的号码列表",
                    endpoint: "/api/numbers/my-numbers",
                    method: "GET",
                    description: "获取用户已获取的手机号码列表",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 },
                        { name: "status", label: "状态过滤", type: "select", options: [
                            { value: "", label: "全部" },
                            { value: "available", label: "可用" },
                            { value: "used", label: "已使用" },
                            { value: "released", label: "已释放" },
                            { value: "blacklisted", label: "已拉黑" }
                        ]}
                    ]
                }
            ],
            account: [
                {
                    name: "查询余额",
                    endpoint: "/api/account/balance",
                    method: "GET",
                    description: "查询用户当前账户余额",
                    params: []
                },
                {
                    name: "获取交易记录",
                    endpoint: "/api/account/transactions",
                    method: "GET",
                    description: "获取用户的交易记录列表",
                    params: [
                        { name: "page", label: "页码", type: "number", value: 1 },
                        { name: "per_page", label: "每页数量", type: "number", value: 10 },
                        { name: "type", label: "交易类型", type: "select", options: [
                            { value: "", label: "全部" },
                            { value: "topup", label: "充值" },
                            { value: "consume", label: "消费" },
                            { value: "refund", label: "退款" }
                        ]}
                    ]
                },
                {
                    name: "账户充值",
                    endpoint: "/api/account/topup",
                    method: "GET",
                    description: "为用户账户充值",
                    params: [
                        { name: "amount", label: "充值金额", type: "number", required: true },
                        { name: "payment_method", label: "支付方式", type: "select", required: true, options: [
                            { value: "alipay", label: "支付宝" },
                            { value: "wechat", label: "微信支付" }
                        ]}
                    ]
                }
            ]
        };
        
        // 初始化函数
        $(document).ready(function() {
            checkAuth();
            bindEvents();
            generateApiForms();
        });
        
        // 检查认证状态
        function checkAuth() {
            if (userToken && Object.keys(userData).length > 0) {
                // 已登录状态
                showLoggedInState();
                
                // 更新页面上的用户信息
                updateUserInfo();
                
                // 检查令牌有效性
                checkTokenValidity();
            } else {
                // 未登录状态
                showLoggedOutState();
            }
        }
        
        // 显示已登录状态
        function showLoggedInState() {
            $('#authCard').addClass('d-none');
            $('#userInfoPanel').removeClass('d-none');
            $('#apiTestPanel').removeClass('d-none');
        }
        
        // 显示未登录状态
        function showLoggedOutState() {
            $('#authCard').removeClass('d-none');
            $('#userInfoPanel').addClass('d-none');
            $('#apiTestPanel').addClass('d-none');
            
            // 清空本地存储的登录信息
            localStorage.removeItem('sms_platform_token');
            localStorage.removeItem('sms_platform_user');
            userToken = null;
            userData = {};
        }
        
        // 更新用户信息
        function updateUserInfo() {
            $('#usernameInfo').text(userData.username || '-');
            $('#emailInfo').text(userData.email || '-');
            $('#balanceInfo').text(userData.balance || '0.00');
        }
        
        // 检查令牌有效性
        function checkTokenValidity() {
            callApi('/api/auth/profile', {}, function(data) {
                // 更新用户信息
                if (data) {
                    userData = data;
                    localStorage.setItem('sms_platform_user', JSON.stringify(userData));
                    updateUserInfo();
                }
            }, function(error) {
                // 如果令牌无效，退出登录
                if (error.status === 401) {
                    showLoggedOutState();
                }
            });
        }
        
        // 绑定事件处理程序
        function bindEvents() {
            // 登录表单提交
            $('#loginForm').on('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // 注册表单提交
            $('#registerForm').on('submit', function(e) {
                e.preventDefault();
                register();
            });
            
            // 清除凭证
            $('#clearToken').on('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // 复制结果
            $('#copyResult').on('click', function() {
                copyToClipboard('#resultContent');
            });
        }
        
        // 登录函数
        function login() {
            const username = $('#username').val();
            const password = $('#password').val();
            
            if (!username || !password) {
                alert('请填写用户名和密码');
                return;
            }
            
            showLoading();
            
            $.ajax({
                url: baseUrl + '/api/auth/login',
                method: 'GET',
                data: { username, password },
                dataType: 'json',
                success: function(response) {
                    hideLoading();
                    
                    if (response.token) {
                        userToken = response.token;
                        userData = response.user;
                        
                        // 保存到本地存储
                        localStorage.setItem('sms_platform_token', userToken);
                        localStorage.setItem('sms_platform_user', JSON.stringify(userData));
                        
                        // 显示已登录状态
                        showLoggedInState();
                        updateUserInfo();
                        
                        // 清空表单
                        $('#loginForm')[0].reset();
                        
                        showResult('登录成功', response);
                    } else {
                        showResult('登录失败', response);
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    handleApiError(xhr);
                }
            });
        }
        
        // 注册函数
        function register() {
            const username = $('#regUsername').val();
            const email = $('#regEmail').val();
            const password = $('#regPassword').val();
            
            if (!username || !email || !password) {
                alert('请填写完整注册信息');
                return;
            }
            
            showLoading();
            
            $.ajax({
                url: baseUrl + '/api/auth/register',
                method: 'GET',
                data: { username, email, password },
                dataType: 'json',
                success: function(response) {
                    hideLoading();
                    
                    if (response.token) {
                        userToken = response.token;
                        userData = response.user;
                        
                        // 保存到本地存储
                        localStorage.setItem('sms_platform_token', userToken);
                        localStorage.setItem('sms_platform_user', JSON.stringify(userData));
                        
                        // 显示已登录状态
                        showLoggedInState();
                        updateUserInfo();
                        
                        // 清空表单
                        $('#registerForm')[0].reset();
                        
                        showResult('注册成功', response);
                    } else {
                        showResult('注册失败', response);
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    handleApiError(xhr);
                }
            });
        }
        
        // 登出函数
        function logout() {
            showLoggedOutState();
        }
        
        // 生成API测试表单
        function generateApiForms() {
            // 用户管理API
            generateApiCategory('user-apis', '用户管理', apiList.user);
            
            // 项目管理API
            generateApiCategory('project-apis', '项目管理', apiList.project);
            
            // 号码管理API
            generateApiCategory('number-apis', '号码管理', apiList.number);
            
            // 账户管理API
            generateApiCategory('account-apis', '账户管理', apiList.account);
        }
        
        // 生成API分类
        function generateApiCategory(elementId, title, apis) {
            const $element = $(`#${elementId}`);
            
            // 设置标题
            $element.html(`
                <div class="card-header">
                    <i class="fas fa-code me-2"></i>${title}
                </div>
                <div class="card-body">
                    <div class="accordion" id="${elementId}-accordion">
                    </div>
                </div>
            `);
            
            // 添加每个API
            const $accordion = $(`#${elementId}-accordion`);
            
            apis.forEach((api, index) => {
                const apiId = `${elementId}-api-${index}`;
                const formId = `${apiId}-form`;
                
                const accordionItem = `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#${apiId}-collapse" aria-expanded="false" aria-controls="${apiId}-collapse">
                                ${api.name}
                            </button>
                        </h2>
                        <div id="${apiId}-collapse" class="accordion-collapse collapse" data-bs-parent="#${elementId}-accordion">
                            <div class="accordion-body">
                                <p class="api-description">${api.description}</p>
                                <p><small class="text-muted">接口: ${api.endpoint}</small></p>
                                <form id="${formId}" class="api-form">
                                    <input type="hidden" name="endpoint" value="${api.endpoint}">
                                    <input type="hidden" name="method" value="${api.method}">
                                    
                                    <div class="row mb-3">
                                        ${generateFormFields(api.params)}
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane me-1"></i>发送请求
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                
                $accordion.append(accordionItem);
                
                // 绑定表单提交事件
                $(`#${formId}`).on('submit', function(e) {
                    e.preventDefault();
                    callApiFromForm(this);
                });
            });
        }
        
        // 生成表单字段
        function generateFormFields(params) {
            if (!params || params.length === 0) {
                return '<div class="col-12"><p class="text-muted">此接口无需额外参数</p></div>';
            }
            
            let html = '';
            
            params.forEach((param) => {
                if (param.isPathParam) {
                    // 路径参数使用隐藏字段记录，但显示为普通输入字段
                    html += `
                        <div class="col-md-6 mb-3">
                            <label class="form-label ${param.required ? 'required-field' : ''}">${param.label}</label>
                            <input type="${param.type}" class="form-control" name="${param.name}" 
                                data-is-path-param="true" ${param.required ? 'required' : ''}
                                ${param.value ? `value="${param.value}"` : ''}>
                        </div>
                    `;
                } else if (param.type === 'hidden') {
                    // 隐藏字段
                    html += `
                        <input type="hidden" name="${param.name}" value="${param.value || ''}">
                    `;
                } else if (param.type === 'select') {
                    // 下拉选择框
                    let options = '';
                    param.options.forEach(option => {
                        options += `<option value="${option.value}">${option.label}</option>`;
                    });
                    
                    html += `
                        <div class="col-md-6 mb-3">
                            <label class="form-label ${param.required ? 'required-field' : ''}">${param.label}</label>
                            <select class="form-select" name="${param.name}" ${param.required ? 'required' : ''}>
                                ${options}
                            </select>
                        </div>
                    `;
                } else {
                    // 普通输入字段
                    html += `
                        <div class="col-md-6 mb-3">
                            <label class="form-label ${param.required ? 'required-field' : ''}">${param.label}</label>
                            <input type="${param.type}" class="form-control" name="${param.name}" 
                                ${param.required ? 'required' : ''} ${param.value ? `value="${param.value}"` : ''}>
                        </div>
                    `;
                }
            });
            
            return html;
        }
        
        // 从表单调用API
        function callApiFromForm(form) {
            const $form = $(form);
            const formData = new FormData($form[0]);
            const endpoint = formData.get('endpoint');
            const method = formData.get('method');
            
            // 构建参数对象
            const params = {};
            const pathParams = {};
            
            // 收集表单字段
            $form.find('input, select, textarea').each(function() {
                const $field = $(this);
                const name = $field.attr('name');
                const value = $field.val();
                
                // 忽略endpoint和method字段
                if (name === 'endpoint' || name === 'method') {
                    return;
                }
                
                // 检查是否为路径参数
                if ($field.data('is-path-param')) {
                    pathParams[name] = value;
                } else if (value) { // 只添加有值的参数
                    params[name] = value;
                }
            });
            
            // 处理路径参数
            let finalEndpoint = endpoint;
            Object.keys(pathParams).forEach(param => {
                finalEndpoint = finalEndpoint.replace(`{${param}}`, pathParams[param]);
            });
            
            // 调用API
            callApi(finalEndpoint, params, function(data) {
                showResult('请求成功', data);
            }, function(error) {
                handleApiError(error);
            });
        }
        
        // 调用API的通用函数
        function callApi(endpoint, params, successCallback, errorCallback) {
            showLoading();
            
            // 添加token参数
            if (userToken) {
                params.token = userToken;
            }
            
            $.ajax({
                url: baseUrl + endpoint,
                method: 'GET', // 所有API都支持GET
                data: params,
                dataType: 'json',
                success: function(response) {
                    hideLoading();
                    if (successCallback) {
                        successCallback(response);
                    }
                },
                error: function(xhr) {
                    hideLoading();
                    if (errorCallback) {
                        errorCallback(xhr);
                    }
                }
            });
        }
        
        // 处理API错误
        function handleApiError(xhr) {
            let errorMessage = '请求失败';
            let errorData = '';
            
            try {
                const response = JSON.parse(xhr.responseText);
                errorMessage = response.message || response.error || '未知错误';
                errorData = response;
            } catch (e) {
                errorMessage = xhr.statusText || '未知错误';
                errorData = { status: xhr.status, statusText: xhr.statusText };
            }
            
            showResult(`错误：${errorMessage}`, errorData);
        }
        
        // 显示结果
        function showResult(title, data) {
            // 设置模态框标题
            $('#resultModalLabel').text(title);
            
            // 设置结果内容
            $('#resultContent').text(JSON.stringify(data, null, 2));
            
            // 显示模态框
            const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
            resultModal.show();
        }
        
        // 复制到剪贴板
        function copyToClipboard(elementId) {
            const text = $(elementId).text();
            navigator.clipboard.writeText(text).then(function() {
                alert('复制成功');
            }, function() {
                alert('复制失败，请手动复制');
            });
        }
        
        // 显示加载指示器
        function showLoading() {
            $('#loading').fadeIn(100);
        }
        
        // 隐藏加载指示器
        function hideLoading() {
            $('#loading').fadeOut(100);
        }
    </script>
</body>
</html>